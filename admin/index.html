<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex" />
  <title>Internal Docs CMS</title>

  <script>window.CMS_MANUAL_INIT = true;</script>
  <script src="https://unpkg.com/decap-cms@3.6.3/dist/decap-cms.js"></script>
  <link rel="stylesheet" href="https://identity.netlify.com/v1/netlify-identity-widget.css" />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
</head>
<body>
  <h1>Loading CMS…</h1>
  <script>
    (async () => {
      const identity = window.netlifyIdentity;
      identity.init({
        locale: 'zh',    // 如果想要内建中文
        // open: 'login'  // 可选：一初始化就弹出登录/注册
      });

      identity.on('init', user => {
        if (user) {
          startCMS();
        } else {
          identity.on('login', () => startCMS());
          identity.open(); // 弹出登录/注册
        }
      });

      async function startCMS() {
        try {
          const res = await fetch('/admin/config.json');
          if (!res.ok) throw new Error(`Cannot load /admin/config.json: ${res.status}`);
          const cfg = await res.json();
          CMS.init({ config: cfg, load_config_file: false });
        } catch (err) {
          document.body.innerHTML = `
            <h1 style="color:red;">CMS 启动失败</h1>
            <pre style="color:red;">${err.message}</pre>`;
          console.error(err);
        }
      }
    })();
  </script>
</body>
</html>
